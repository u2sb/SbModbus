<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pvm="clr-namespace:SbModbus.Tool.ViewModels.Pages"
             xmlns:bh="clr-namespace:SbModbus.Tool.Utils.Behavior"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="SbModbus.Tool.Views.Pages.ModbusPage"
             d:DataContext="{d:DesignInstance pvm:ModbusPageViewModel}">
  <UserControl.Resources>
    <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
      <Setter Property="FontSize" Value="{StaticResource SubHeadFontSize}" />
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="HorizontalAlignment" Value="Left" />
    </Style>
    <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
      <Setter Property="FontSize" Value="{StaticResource SubHeadFontSize}" />
      <Setter Property="Margin" Value="0,5" />
      <Setter Property="VerticalAlignment" Value="Stretch" />
      <Setter Property="HorizontalAlignment" Value="Right" />
      <Setter Property="Width" Value="140" />
      <Setter Property="TextAlignment" Value="Center" />
    </Style>
    <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
      <Setter Property="Margin" Value="0,5" />
      <Setter Property="VerticalAlignment" Value="Stretch" />
      <Setter Property="HorizontalAlignment" Value="Right" />
      <Setter Property="Width" Value="140" />
      <Setter Property="HorizontalContentAlignment" Value="Stretch" />
      <Setter Property="FontWeight" Value="Normal" />
      <Setter Property="FontSize" Value="{StaticResource SubHeadFontSize}" />
    </Style>
    <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
      <Setter Property="Margin" Value="5,0" />
      <Setter Property="Height" Value="35" />
      <Setter Property="FontSize" Value="{StaticResource SubHeadFontSize}" />
      <Setter Property="HorizontalAlignment" Value="Stretch" />
      <Setter Property="VerticalAlignment" Value="Stretch" />
    </Style>
  </UserControl.Resources>
  <Grid ColumnDefinitions="480,*">
    <Grid Column="0" Grid.ColumnDefinitions="*, *">

      <!-- 左侧区域 -->
      <Border Grid.Column="0" Margin="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
              BorderBrush="Black" BorderThickness="1">
        <StackPanel Margin="5">
          <Grid Height="80">
            <TextBlock Margin="0,10" VerticalAlignment="Top" Text="{StaticResource lang.modbusInterface}" />
            <ComboBox HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="35" Width="Auto"
                      SelectedIndex="{Binding ModbusClientType, 
                        Converter={StaticResource EnumToIntConverter}}">
              <ComboBoxItem Content="{StaticResource lang.modbusVirtualType}" />
              <ComboBoxItem Content="{StaticResource lang.modbusRtuType}" />
              <ComboBoxItem Content="{StaticResource lang.modbusTcpType}" />
              <ComboBoxItem Content="{StaticResource lang.modbusRtuOverTcpType}" />
            </ComboBox>

          </Grid>

          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.connectionStatus}" />
            <Rectangle Margin="5,0" Width="130" Height="15" HorizontalAlignment="Right"
                       Fill="{Binding IsConnected, Converter={StaticResource BoolToColorBrushConverter}}" />
          </Grid>

          <Rectangle Margin="0,5" HorizontalAlignment="Stretch" Height="3" Fill="Gray" />

          <Grid
            Visibility="{Binding ModbusClientType, 
                            Converter={StaticResource EnumToVisibilityConverter},
                            ConverterParameter=ModbusRTU }">
            <StackPanel>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.protName}" />
                <ComboBox
                  ItemsSource="{Binding SerialPortNames}"
                  SelectedValue="{Binding SerialPortName}" />
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.baudRate}" />
                <TextBox
                  Text="{Binding BaudRateString}" />
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.dataBit}" />
                <ComboBox SelectedValuePath="Tag"
                          SelectedValue="{Binding DataBits, Converter={StaticResource IntToStringConverter}}">
                  <ComboBoxItem Tag="8" Content="8" />
                  <ComboBoxItem Tag="7" Content="7" />
                  <ComboBoxItem Tag="6" Content="6" />
                  <ComboBoxItem Tag="5" Content="5" />
                </ComboBox>
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.parityBit}" />
                <ComboBox
                  ItemsSource="{Binding ParityValues}"
                  SelectedIndex="{Binding Parity, 
                    Converter={StaticResource EnumToIntConverter}}" />
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.stopBit}" />
                <ComboBox
                  ItemsSource="{Binding StopBitsValues}"
                  SelectedIndex="{Binding StopBits, 
                    Converter={StaticResource EnumToIntConverter}}" />
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.flowControl}" />
                <ComboBox
                  ItemsSource="{Binding HandshakeValues}"
                  SelectedIndex="{Binding Handshake, 
                    Converter={StaticResource EnumToIntConverter}}" />
              </Grid>
            </StackPanel>
          </Grid>

          <Grid
            Visibility="{Binding ModbusClientType, 
                            Converter={StaticResource EnumToVisibilityConverter},
                            ConverterParameter=ModbusTCP;ModbusRTUOverTcp }">

            <StackPanel>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.targetIp}" />
                <TextBox
                  Text="{Binding TargetIp}" />
              </Grid>
              <Grid Height="50">
                <TextBlock Text="{StaticResource lang.targetPort}" />
                <TextBox
                  Text="{Binding TargetPort}" />
              </Grid>
            </StackPanel>
          </Grid>
          <StackPanel Margin="0,20" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Margin="10,0" Width="80" FontWeight="Bold"
                    Content="{StaticResource lang.btnConnect}"
                    Command="{Binding ConnectCommand}" />
            <Button Margin="10,0" Width="80" FontWeight="Bold"
                    Content="{StaticResource lang.btnDisConnect}"
                    Command="{Binding DisconnectCommand}" />
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- 中间部分 -->
      <Border Grid.Column="1" Margin="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
              BorderBrush="Black" BorderThickness="1">
        <StackPanel Margin="5">
          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.modbusStationId}" />
            <TextBox
              Text="{Binding StationIdString}" />
          </Grid>
          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.modbusEncodeMode}" />
            <ComboBox
              ItemsSource="{Binding EncodingModes}"
              SelectedIndex="{Binding EncodingMode, 
                    Converter={StaticResource EnumToIntConverter}}" />
          </Grid>
          <Grid Height="100">
            <TextBlock Margin="0,15" VerticalAlignment="Top" Text="{StaticResource lang.modbusReadFunCode}" />
            <ComboBox HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="35" Width="Auto"
                      Margin="0,0,0,15"
                      SelectedIndex="{Binding SelectedModbusReadFunCodeIndex}">
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeReadCoils}" />
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeReadDiscreteInputs}" />
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeReadHoldingRegisters}" />
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeReadInputRegisters}" />
            </ComboBox>
          </Grid>
          <Grid Height="100">
            <TextBlock Margin="0,15" VerticalAlignment="Top" Text="{StaticResource lang.modbusWriteFunCode}" />
            <ComboBox HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="35" Width="Auto"
                      Margin="0,0,0,15"
                      SelectedIndex="{Binding SelectedModbusWriteFunCodeIndex}">
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeWriteSingleCoil}" />
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeWriteSingleRegister}" />
              <ComboBoxItem Content="{StaticResource lang.modbusFunCodeWriteMultipleRegisters}" />
            </ComboBox>
          </Grid>
          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.modbusAddress}" />
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
              <TextBox Margin="10,5" Width="70" Text="{Binding ModbusAddressString}" />
              <ComboBox Width="70" SelectedIndex="{Binding ModbusAddressType}">
                <ComboBoxItem Content="DEC" />
                <ComboBoxItem Content="HEX" />
              </ComboBox>
            </StackPanel>
          </Grid>
          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.modbusReadLength}" />
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
              <TextBox Margin="10,5" Width="70" Text="{Binding ReadNumberString}" />
              <ComboBox Width="70" SelectedIndex="{Binding ReadNumberType}">
                <ComboBoxItem Content="DEC" />
                <ComboBoxItem Content="HEX" />
              </ComboBox>
            </StackPanel>
          </Grid>
          <Grid Height="50">
            <TextBlock Text="{StaticResource lang.modbusValueType}" />
            <ComboBox
              ItemsSource="{Binding ModbusValueTypes}"
              SelectedIndex="{Binding SelectedModbusValueType, 
                    Converter={StaticResource EnumToIntConverter}}" />
          </Grid>
          <Grid Height="85">
            <TextBlock Margin="0,15" VerticalAlignment="Top" Text="{StaticResource lang.modbusValue}" />
            <StackPanel Orientation="Horizontal" Height="50" Width="Auto" VerticalAlignment="Bottom">
              <TextBox HorizontalAlignment="Stretch" Margin="0,5,10,5" Width="128"
                       Text="{Binding ModbusInputValueString}" />
              <ComboBox Width="70" SelectedIndex="{Binding ModbusInputValueType}">
                <ComboBoxItem Content="DEC" />
                <ComboBoxItem Content="HEX" />
              </ComboBox>
            </StackPanel>
          </Grid>
          <StackPanel Margin="0,20" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Margin="10,0" Width="80" FontWeight="Bold"
                    Content="{StaticResource lang.btnRead}"
                    Command="{Binding ReadCommand}" />
            <Button Margin="10,0" Width="80" FontWeight="Bold"
                    Content="{StaticResource lang.btnWrite}"
                    Command="{Binding WriteCommand}" />
          </StackPanel>
          <Grid>
            <Button Margin="10,0" Width="180" FontWeight="Bold"
                    Content="{StaticResource lang.btnClear}"
                    Command="{Binding CleanOutputCommand}" />
          </Grid>
        </StackPanel>
      </Border>
    </Grid>


    <Border Grid.Column="1" Margin="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
            BorderBrush="Black" BorderThickness="1">
      <Grid RowDefinitions="*, 10, 2*">
        <Grid Row="0">
          <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto"
                        bh:SmartScrollBehavior.IsEnabled="True">
            <ItemsControl ItemsSource="{Binding DsLogs}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Grid Margin="2" ColumnDefinitions="Auto, 10, *">
                    <hc:SimpleText Grid.Column="0" VerticalAlignment="Top" HorizontalAlignment="Left" FontSize="18"
                                   Foreground="CornflowerBlue"
                                   Text="{Binding DateTimeString}" />
                    <hc:SimpleText Grid.Column="2" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                   TextWrapping="Wrap" FontSize="18"
                                   Foreground="{Binding TextColor}"
                                   Text="{Binding HexString}" />
                  </Grid>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Grid>

        <Rectangle Grid.Row="1" Margin="5,0" HorizontalAlignment="Stretch" Height="2" Fill="Gray" />

        <Grid Row="2">
          <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto"
                        bh:SmartScrollBehavior.IsEnabled="True">
            <ItemsControl ItemsSource="{Binding MsLogs}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Grid Margin="2" ColumnDefinitions="Auto, 10, *">
                    <TextBlock Grid.Column="0" VerticalAlignment="Top" HorizontalAlignment="Left" FontSize="16"
                               TextAlignment="Center"
                               Text="{Binding DateTimeString}" />
                    <Grid Column="2" RowDefinitions="25, Auto"
                          ColumnDefinitions="80, 160, 80, 80, 100, 100, 100, 120, 120, 120">
                      <Border Grid.Row="0" Grid.Column="0" Height="25" BorderBrush="Gray" BorderThickness="1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16"
                                   Text="address" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="1" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="bit" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="2" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="short" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="3" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16"
                                   Text="ushort" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="4" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="int" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="5" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="uint" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="6" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="float" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="7" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="long" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="8" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Text="ulong" />
                      </Border>
                      <Border Grid.Row="0" Grid.Column="9" Height="25" BorderBrush="Gray" BorderThickness="0,1,1,1">
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16"
                                   Text="double" />
                      </Border>
                      <ItemsControl Grid.Row="1" Grid.Column="0" ItemsSource="{Binding Address}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="25" BorderBrush="Gray" BorderThickness="1,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="1" ItemsSource="{Binding Cells}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="25" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="2" ItemsSource="{Binding Shorts}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="25" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="3" ItemsSource="{Binding UShorts}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="25" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="4" ItemsSource="{Binding Ints}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="50" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="5" ItemsSource="{Binding UInts}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="50" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="6" ItemsSource="{Binding Floats}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="50" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="7" ItemsSource="{Binding Longs}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="100" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="8" ItemsSource="{Binding ULongs}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="100" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                      <ItemsControl Grid.Row="1" Grid.Column="9" ItemsSource="{Binding Doubles}">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Height="100" BorderBrush="Gray" BorderThickness="0,0,1,1">
                              <hc:SimpleText HorizontalAlignment="Center" VerticalAlignment="Center"
                                             FontSize="16" TextWrapping="Wrap"
                                             Text="{Binding }" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                    </Grid>
                  </Grid>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Grid>
      </Grid>
    </Border>
  </Grid>
</UserControl>